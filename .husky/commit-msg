#!/usr/bin/env sh

msg_file=$1
msg=$(cat "$msg_file")

# Get current branch name
branch=$(git rev-parse --abbrev-ref HEAD 2>/dev/null)

# Color codes for better readability
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Conventional commits validation
if ! echo "$msg" | grep -Eq "^(feat|fix|chore|docs|refactor|test|style|perf|ci|build|revert|release|hotfix)(\(.+\))?: .+"; then
  echo "${RED}‚ùå Invalid commit message format!${NC}"
  echo ""
  echo "${BLUE}üìù Required format:${NC} ${YELLOW}<type>(<scope>): <description>${NC}"
  echo ""
  echo "${GREEN}‚úÖ Valid types:${NC}"
  echo "  ${YELLOW}feat${NC}     - New feature"
  echo "  ${YELLOW}fix${NC}      - Bug fix"
  echo "  ${YELLOW}hotfix${NC}   - Emergency production fix"
  echo "  ${YELLOW}release${NC}  - Release preparation"
  echo "  ${YELLOW}refactor${NC} - Code refactoring"
  echo "  ${YELLOW}perf${NC}     - Performance improvement"
  echo "  ${YELLOW}test${NC}     - Adding/updating tests"
  echo "  ${YELLOW}docs${NC}     - Documentation changes"
  echo "  ${YELLOW}style${NC}    - Code style/formatting"
  echo "  ${YELLOW}chore${NC}    - Maintenance tasks"
  echo "  ${YELLOW}ci${NC}       - CI/CD changes"
  echo "  ${YELLOW}build${NC}    - Build system changes"
  echo "  ${YELLOW}revert${NC}   - Revert previous commit"
  echo ""
  echo "${GREEN}üìö Examples:${NC}"
  echo "  feat(auth): add OAuth login support"
  echo "  fix(api): resolve timeout on large requests"
  echo "  hotfix(security): patch XSS vulnerability"
  echo "  docs: update installation instructions"
  echo "  refactor(utils): simplify date formatting"
  echo ""
  echo "${BLUE}üí° Tip:${NC} Use 'git commit --amend' to fix your commit message"
  echo ""
  exit 1
fi

# Success message
echo "${GREEN}‚úÖ Commit message is valid!${NC}"
echo ""