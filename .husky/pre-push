#!/usr/bin/env sh

# Color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "${BLUE}üöÄ Running pre-push checks...${NC}"
echo ""

# Get current branch
current_branch=$(git rev-parse --abbrev-ref HEAD)

# Define valid branch name patterns
valid_patterns="^(feature|feat|bugfix|fix|hotfix|release|chore|docs)/"

# Check if branch follows naming convention
if ! echo "$current_branch" | grep -Eq "$valid_patterns"; then
  # Allow main, dev, and other permanent branches
  if echo "$current_branch" | grep -Eq "^(main|dev|develop|production)$"; then
    echo "${GREEN}‚úÖ Pushing to permanent branch: $current_branch${NC}"
    echo ""
  else
    echo "${RED}‚ùå Invalid branch name: '$current_branch'${NC}"
    echo ""
    echo "${YELLOW}Branch name does not follow naming conventions!${NC}"
    echo ""
    echo "${BLUE}üìù Valid branch naming patterns:${NC}"
    echo "  ${GREEN}feature/${NC}<description>  - New features"
    echo "  ${GREEN}feat/${NC}<description>     - New features (short)"
    echo "  ${GREEN}bugfix/${NC}<description>   - Bug fixes"
    echo "  ${GREEN}fix/${NC}<description>      - Bug fixes (short)"
    echo "  ${GREEN}hotfix/${NC}<description>   - Emergency fixes"
    echo "  ${GREEN}release/${NC}v<version>     - Release branches"
    echo "  ${GREEN}chore/${NC}<description>    - Maintenance tasks"
    echo "  ${GREEN}docs/${NC}<description>     - Documentation"
    echo ""
    echo "${GREEN}‚úÖ Valid examples:${NC}"
    echo "  feature/AUTH-123-user-login"
    echo "  feat/add-dark-mode"
    echo "  bugfix/fix-login-crash"
    echo "  fix/payment-validation"
    echo "  hotfix/v1.2.1-security-patch"
    echo "  release/v1.2.0"
    echo "  chore/update-dependencies"
    echo "  docs/api-documentation"
    echo ""
    echo "${BLUE}üí° To rename your branch:${NC}"
    echo "  git branch -m $current_branch <new-valid-name>"
    echo ""
    echo "${BLUE}üí° To bypass (not recommended):${NC}"
    echo "  git push --no-verify"
    echo ""
    exit 1
  fi
fi

echo "${GREEN}‚úÖ Branch name is valid: $current_branch${NC}"
echo ""
echo "${GREEN}üöÄ Pushing to remote...${NC}"
echo ""