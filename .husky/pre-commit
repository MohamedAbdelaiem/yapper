#!/usr/bin/env sh

# Color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "${BLUE}üîç Running pre-commit checks...${NC}"
echo ""

# Run lint-staged (ESLint + Prettier on staged files)
echo "${YELLOW}üìù Running lint-staged...${NC}"
npx lint-staged

if [ $? -ne 0 ]; then
  echo ""
  echo "${RED}‚ùå Lint-staged failed!${NC}"
  echo ""
  echo "${YELLOW}Common fixes:${NC}"
  echo "  ${BLUE}‚Ä¢${NC} Run: npm run lint:fix"
  echo "  ${BLUE}‚Ä¢${NC} Run: npm run format"
  echo "  ${BLUE}‚Ä¢${NC} Fix remaining issues manually"
  echo ""
  echo "${BLUE}üí° To bypass (use sparingly):${NC}"
  echo "  git commit --no-verify"
  echo ""
  exit 1
fi

echo ""
echo "${GREEN}‚úÖ Lint-staged passed!${NC}"
echo ""

# Optional: Run TypeScript type check on staged files only
echo "${YELLOW}üîé Running TypeScript check on staged files...${NC}"

npm run type-check
  
if [ $? -ne 0 ]; then
  echo ""
  echo "${RED}‚ùå TypeScript type check failed!${NC}"
  echo ""
  echo "${YELLOW}Fix type errors before committing${NC}"
  echo ""
  echo "${BLUE}üí° To bypass (use sparingly):${NC}"
  echo "  git commit --no-verify"
  echo ""
  exit 1
fi

echo ""
echo "${GREEN}‚úÖ TypeScript check passed!${NC}"
echo ""

# Check for TODO comments (optional - just warning)
echo "${YELLOW}üîç Checking for TODO comments...${NC}"

if [ -n "$STAGED_JS_FILES" ]; then
  TODOS=$(echo "$STAGED_JS_FILES" | xargs grep -n "// TODO\|// FIXME\|// HACK" || true)
  
  if [ -n "$TODOS" ]; then
    echo ""
    echo "${YELLOW}‚ÑπÔ∏è  Info: Found TODO/FIXME comments:${NC}"
    echo "$TODOS"
    echo ""
    echo "${BLUE}üí° Consider creating issues for these items${NC}"
    echo ""
    # Not blocking - just informational
  fi
fi
# Success!
echo ""
echo "${GREEN}‚ú® All pre-commit checks passed!${NC}"
echo "${GREEN}‚úÖ Ready to commit${NC}"
echo ""